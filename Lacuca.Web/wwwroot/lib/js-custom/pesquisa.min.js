"use strict";!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):t(jQuery||Zepto)}(function(t){var a=function(a,e,n){var r={invalid:[],getCaret:function(){try{var t,e=0,n=a.get(0),s=document.selection,o=n.selectionStart;return s&&-1===navigator.appVersion.indexOf("MSIE 10")?((t=s.createRange()).moveStart("character",-r.val().length),e=t.text.length):(o||"0"===o)&&(e=o),e}catch(t){}},setCaret:function(t){try{if(a.is(":focus")){var e,n=a.get(0);n.setSelectionRange?(n.focus(),n.setSelectionRange(t,t)):((e=n.createTextRange()).collapse(!0),e.moveEnd("character",t),e.moveStart("character",t),e.select())}}catch(t){}},events:function(){a.on("keydown.mask",function(t){a.data("mask-keycode",t.keyCode||t.which)}).on(t.jMaskGlobals.useInput?"input.mask":"keyup.mask",r.behaviour).on("paste.mask drop.mask",function(){setTimeout(function(){a.keydown().keyup()},100)}).on("change.mask",function(){a.data("changed",!0)}).on("blur.mask",function(){c===r.val()||a.data("changed")||a.trigger("change"),a.data("changed",!1)}).on("blur.mask",function(){c=r.val()}).on("focus.mask",function(a){!0===n.selectOnFocus&&t(a.target).select()}).on("focusout.mask",function(){n.clearIfNotMatch&&!s.test(r.val())&&r.val("")})},getRegexMask:function(){for(var t,a,n,r,s,c,i=[],l=0;l<e.length;l++)(t=o.translation[e.charAt(l)])?(a=t.pattern.toString().replace(/.{1}$|^.{1}/g,""),n=t.optional,(r=t.recursive)?(i.push(e.charAt(l)),s={digit:e.charAt(l),pattern:a}):i.push(n||r?a+"?":a)):i.push(e.charAt(l).replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return c=i.join(""),s&&(c=c.replace(new RegExp("("+s.digit+"(.*"+s.digit+")?)"),"($1)?").replace(new RegExp(s.digit,"g"),s.pattern)),new RegExp(c)},destroyEvents:function(){a.off(["input","keydown","keyup","paste","drop","blur","focusout",""].join(".mask "))},val:function(t){var e,n=a.is("input")?"val":"text";return arguments.length>0?(a[n]()!==t&&a[n](t),e=a):e=a[n](),e},getMCharsBeforeCount:function(t,a){for(var n=0,r=0,s=e.length;r<s&&r<t;r++)o.translation[e.charAt(r)]||(t=a?t+1:t,n++);return n},caretPos:function(t,a,n,s){return o.translation[e.charAt(Math.min(t-1,e.length-1))]?Math.min(t+n-a-s,n):r.caretPos(t+1,a,n,s)},behaviour:function(e){e=e||window.event,r.invalid=[];var n=a.data("mask-keycode");if(-1===t.inArray(n,o.byPassKeys)){var s=r.getCaret(),c=r.val().length,i=r.getMasked(),l=i.length,u=r.getMCharsBeforeCount(l-1)-r.getMCharsBeforeCount(c-1),f=s<c;return r.val(i),f&&(8!==n&&46!==n&&(s=r.caretPos(s,c,l,u)),r.setCaret(s)),r.callbacks(e)}},getMasked:function(t,a){var s,c,i=[],l=void 0===a?r.val():a+"",u=0,f=e.length,h=0,k=l.length,d=1,v="push",p=-1;for(n.reverse?(v="unshift",d=-1,s=0,u=f-1,h=k-1,c=function(){return u>-1&&h>-1}):(s=f-1,c=function(){return u<f&&h<k});c();){var g=e.charAt(u),m=l.charAt(h),M=o.translation[g];M?(m.match(M.pattern)?(i[v](m),M.recursive&&(-1===p?p=u:u===s&&(u=p-d),s===p&&(u-=d)),u+=d):M.optional?(u+=d,h-=d):M.fallback?(i[v](M.fallback),u+=d,h-=d):r.invalid.push({p:h,v:m,e:M.pattern}),h+=d):(t||i[v](g),m===g&&(h+=d),u+=d)}var y=e.charAt(s);return f!==k+1||o.translation[y]||i.push(y),i.join("")},callbacks:function(t){var s=r.val(),o=s!==c,i=[s,t,a,n],l=function(t,a,e){"function"==typeof n[t]&&a&&n[t].apply(this,e)};l("onChange",!0===o,i),l("onKeyPress",!0===o,i),l("onComplete",s.length===e.length,i),l("onInvalid",r.invalid.length>0,[s,t,a,r.invalid,n])}};a=t(a);var s,o=this,c=r.val();e="function"==typeof e?e(r.val(),void 0,a,n):e,o.mask=e,o.options=n,o.remove=function(){var t=r.getCaret();return r.destroyEvents(),r.val(o.getCleanVal()),r.setCaret(t-r.getMCharsBeforeCount(t)),a},o.getCleanVal=function(){return r.getMasked(!0)},o.getMaskedVal=function(t){return r.getMasked(!1,t)},o.init=function(e){if(e=e||!1,n=n||{},o.clearIfNotMatch=t.jMaskGlobals.clearIfNotMatch,o.byPassKeys=t.jMaskGlobals.byPassKeys,o.translation=t.extend({},t.jMaskGlobals.translation,n.translation),o=t.extend(!0,{},o,n),s=r.getRegexMask(),!1===e){n.placeholder&&a.attr("placeholder",n.placeholder),a.data("mask")&&a.attr("autocomplete","off"),r.destroyEvents(),r.events();var c=r.getCaret();r.val(r.getMasked()),r.setCaret(c+r.getMCharsBeforeCount(c,!0))}else r.events(),r.val(r.getMasked())},o.init(!a.is("input"))};t.maskWatchers={};var e=function(){var e=t(this),r={},s=e.attr("data-mask");if(e.attr("data-mask-reverse")&&(r.reverse=!0),e.attr("data-mask-clearifnotmatch")&&(r.clearIfNotMatch=!0),"true"===e.attr("data-mask-selectonfocus")&&(r.selectOnFocus=!0),n(e,s,r))return e.data("mask",new a(this,s,r))},n=function(a,e,n){n=n||{};var r=t(a).data("mask"),s=JSON.stringify,o=t(a).val()||t(a).text();try{return"function"==typeof e&&(e=e(o)),"object"!=typeof r||s(r.options)!==s(n)||r.mask!==e}catch(t){}};t.fn.mask=function(e,r){r=r||{};var s=this.selector,o=t.jMaskGlobals,c=o.watchInterval,i=r.watchInputs||o.watchInputs,l=function(){if(n(this,e,r))return t(this).data("mask",new a(this,e,r))};return t(this).each(l),s&&""!==s&&i&&(clearInterval(t.maskWatchers[s]),t.maskWatchers[s]=setInterval(function(){t(document).find(s).each(l)},c)),this},t.fn.masked=function(t){return this.data("mask").getMaskedVal(t)},t.fn.unmask=function(){return clearInterval(t.maskWatchers[this.selector]),delete t.maskWatchers[this.selector],this.each(function(){var a=t(this).data("mask");a&&a.remove().removeData("mask")})},t.fn.cleanVal=function(){return this.data("mask").getCleanVal()},t.applyDataMask=function(a){((a=a||t.jMaskGlobals.maskElements)instanceof t?a:t(a)).filter(t.jMaskGlobals.dataMaskAttr).each(e)};var r,s,o,c={maskElements:"input,td,span,div",dataMaskAttr:"*[data-mask]",dataMask:!0,watchInterval:300,watchInputs:!0,useInput:(r="input",o=document.createElement("div"),(s=(r="on"+r)in o)||(o.setAttribute(r,"return;"),s="function"==typeof o[r]),o=null,s),watchDataMask:!1,byPassKeys:[9,16,17,18,36,37,38,39,40,91],translation:{0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}}};t.jMaskGlobals=t.jMaskGlobals||{},(c=t.jMaskGlobals=t.extend(!0,{},c,t.jMaskGlobals)).dataMask&&t.applyDataMask(),setInterval(function(){t.jMaskGlobals.watchDataMask&&t.applyDataMask()},c.watchInterval)});
var TIPOSELETOR={SELECT:0,INPUT:1};function Binder(t){this.Root=t,this.Root[0].innerHTML=""}Binder.prototype.Bind=function(t,e){var r=(new DOMParser).parseFromString(t,"text/html");this.BindValues(r,e),this.BindDisplay(r,e),this.BindCollection(r,e);for(var n=0;n<r.body.childNodes.length;n++)this.Root[0].appendChild(r.body.childNodes[n])},Binder.prototype.BindDisplay=function(t,e){for(var r=t.querySelectorAll("[data-display]"),n=0;n<r.length;n++){var i=r[n],a=i.getAttribute("data-display"),o=0!==a.indexOf("!");e[Util.toCamelCase(a.replace("!",""))]!==o&&(i.style.display="none")}},Binder.prototype.BindCollection=function(t,e){for(var r=t.querySelectorAll("[data-collection]"),n=0;n<r.length;n++)for(var i=r[n],a=i.getAttribute("data-collection"),o=Util.toCamelCase(i.getAttribute("data-value")),l=Util.toCamelCase(i.getAttribute("data-text")),u=e[a],c=0;c<u.length;c++){var d=u[c],s=document.createElement("option");s.setAttribute("value",d[o]),s.innerText=d[l],i.append(s)}},Binder.prototype.BindValues=function(t,e){for(var r=t.querySelectorAll("[data-value]"),n=0;n<r.length;n++){var i=r[n],a=Util.toCamelCase(i.getAttribute("data-value"));void 0!==i.value?i.value=e[a]:void 0!==i.innerText?i.innerText=e[a]:void 0!==i.innerHTML&&(i.innerHTML=e[a])}};var Seletor={get:function(t,e){return e===TIPOSELETOR.INPUT?$('input[name="'+t+'"]').val():e===TIPOSELETOR.SELECT?$('select[name="'+t+'"] option:selected').val():void 0}};function ViewHelper(){this.getView=function(t,e){$.get({url:t,cache:!1}).then(function(t){e(t)})}}var Util=function(){return{isCharacterNumeric:function(t){return t>=48&&t<=57||8===t||46===t||9===t||t>=37&&t<=40||t>=96&&t<=105},toCamelCase:function(t){return t.charAt(0).toLowerCase()+t.substring(1)},isCNPJ:function(t){if(""===(t=t.replace(/[^0-9]+/g,"")))return!1;if(14!==t.length)return!1;if("00000000000000"===t||"11111111111111"===t||"22222222222222"===t||"33333333333333"===t||"44444444444444"===t||"55555555555555"===t||"66666666666666"===t||"77777777777777"===t||"88888888888888"===t||"99999999999999"===t)return!1;for(var e=t.length-2,r=t.substring(0,e),n=t.substring(e),i=0,a=e-7,o=e;o>=1;o--)i+=r.charAt(e-o)*a--,a<2&&(a=9);var l=i%11<2?0:11-i%11;if(l!=n.charAt(0))return!1;for(e+=1,r=t.substring(0,e),i=0,a=e-7,o=e;o>=1;o--)i+=r.charAt(e-o)*a--,a<2&&(a=9);return(l=i%11<2?0:11-i%11)==n.charAt(1)},getOnlyNumber:function(t){return t.replace(/[^0-9]+/g,"")}}}();
function Item(){}function Navegacao(){this.Url=function(e){window.location.href=e}}function Validacao(e){this.Item=e,this.message=""}Item.prototype.TipoItem={},Item.prototype.TipoItem.Get=function(){return $('select[name="TipoItem"] option:selected').val()},Item.prototype.Referencia={},Item.prototype.Referencia.Get=function(){return $('input[name="Referencia"]').val()},Item.prototype.ReferenciaAnvisa={},Item.prototype.ReferenciaAnvisa.Get=function(){return $('input[name="referenciaAnvisa"]').val()},Item.prototype.CNPJ={},Item.prototype.CNPJ.Get=function(){var e=$('input[name="CNPJ"]').val();return Util.getOnlyNumber(e)},Item.prototype.ID={},Item.prototype.ID.Get=function(){return $('input[name="Id"]').val()},Item.prototype.IdCentral={},Item.prototype.IdCentral.Get=function(){return $('input[name="IdCentral"]').val()},Item.prototype.Mercado={},Item.prototype.Mercado.Get=function(){return $('input[name="Mercado"]').val()},Item.prototype.CodigoAnvisa={},Item.prototype.CodigoAnvisa.Get=function(){return $('input[name="CodigoAnvisa"]').val()},Item.prototype.Descricao={},Item.prototype.Descricao.Get=function(){return $('input[name="Descricao"]').val()},Item.prototype.Operadora={},Item.prototype.Operadora.Get=function(){return $('select[name="operadora"]').val()},Item.prototype.TipoItem.Bloquear=function(){"0"!==this.Get()&&$('select[name="TipoItem"').attr("disabled",!0)},Item.prototype.Pesquisar=function(){var e=this,t=new Validacao(this);(t.CodigoAnvisa(),t.isValid())?(this.LimparPagina(),$.ajax({url:"/Item/Pesquisar",type:"Post",data:JSON.stringify({TipoItem:e.TipoItem.Get(),Referencia:e.Referencia.Get(),CNPJ:e.CNPJ.Get(),CodigoAnvisa:e.CodigoAnvisa.Get()}),contentType:"application/json",success:function(t){t.idAnvisa?(e.RenderizarAnvisaCallBack(t),t.itemAprovado?e.RenderizarCodigoCallBack(t.codigo):e.RenderizarOperadoras(t)):e.ItemNaoExisteCallBack(t)},error:e.ExibirErro})):(new Modal).Info("Validações",t.Message(),"Fechar")},Item.prototype.RenderizarOperadoras=function(e){(new ViewHelper).getView("/pages/html/operadoras.html",function(t){var o=$("#operadorasSecao");new Binder(o).Bind(t,e)})},Item.prototype.RenderizarAnvisaCallBack=function(e){var t=e,o=new ViewHelper,a=1===t.mercado?"material.html":"medicamento.html";o.getView("/pages/html/"+a,function(e){var o=$('div[data-load-view="anvisa"]');new Binder(o).Bind(e,t)})},Item.prototype.LimparPagina=function(){var e=$('div[name="cardconfirmacao"]');e&&$(e).remove();var t=$('div[name="secaocodigo"]');t&&$(t).remove()},Item.prototype.Confirmar=function(){var e=this;$.ajax({url:"/Item/Confirmar",type:"Post",data:JSON.stringify({IdAnvisa:e.ID.Get(),Referencia:e.ReferenciaAnvisa.Get(),IdCentral:e.IdCentral.Get(),Mercado:e.Mercado.Get(),IdOperadora:e.Operadora.Get()}),contentType:"application/json",success:function(t,o,a){e.LimparPagina(),e.RenderizarCodigoCallBack(t.codigo)},error:e.ExibirErro})},Item.prototype.ItemNaoExisteCallBack=function(e){var t=this,o=new Modal,a=e;o.Confirm("Pesquisa","Item não encontrado. Deseja cadastrar ?","Sim","Não",function(){t.TipoItem.Bloquear();var e=new ViewHelper;e.getView("/pages/html/inclusao.html",function(e){$('div[name="pesquisa"]').remove(),$("div.card-block").append(e);var t=document.getElementById("filer_input_anexos");t.addEventListener("change",function(e){var o=document.getElementById("selectedFiles");t.files.length>0?o.innerHTML=t.files.length+" arquivo(s) selecionado(s)":o.innerHTML=""})}),t.RenderizarOperadoras(a),e.getView("/pages/html/breadcrumb.html",function(e){var t=$('div[data-load-view="breadcrumb"]'),o={header:"Inclusão de Item"};new Binder(t).Bind(e,o)})})},Item.prototype.RenderizarCodigoCallBack=function(e){var t=e;(new ViewHelper).getView("/pages/html/codigo.html",function(e){var o=$('div[data-load-view="codigo"]');new Binder(o).Bind(e,t)})},Item.prototype.Incluir=function(){var e=this,t=new Validacao(this);if(t.TipoItem(),t.CNPJ(),t.CodigoAnvisa(),t.Descricao(),t.Anexo(),t.isValid()){var o=new FormData;o.append("TipoItem",e.TipoItem.Get()),o.append("Referencia",e.Referencia.Get()),o.append("CNPJ",e.CNPJ.Get()),o.append("CodigoAnvisa",e.CodigoAnvisa.Get()),o.append("Descricao",e.Descricao.Get()),o.append("OperadoraID",e.Operadora.Get());for(var a=document.getElementById("filer_input_anexos").files,i=0;i<a.length;i++)o.append("Anexos",a.item(i));var n=new XMLHttpRequest;n.open("Post","/Item/Incluir",!0),n.onload=function(t){var o=new Modal;if(201===n.status){var a=n.getResponseHeader("location");o.Success("Cadastro","Item cadastrado com sucesso. Codificação provisória para o produto será atribuída posteriormente, aguarde retorno.","Fechar",e.Voltar(a))}else 409===n.status?o.Info("Validações",n.responseText,"OK"):e.Erro(n.responseText,n.status)},n.send(o)}else{(new Modal).Info("Validações",t.Message(),"Fechar")}},Item.prototype.Voltar=function(e){var t=e;return function(){(new Navegacao).Url(t)}},Item.prototype.Erro=function(e,t){var o=new Modal;400===t?o.Info("Info",e,"Fechar"):o.Error("Erro",e,"Fechar")},Item.prototype.ExibirErro=function(e,t,o){var a=new Modal;400===e.status?a.Info("Info",e.responseJSON.message,"Fechar"):a.Error("Erro",e.responseJSON.message,"Fechar")},Item.prototype.RequisitarNotificacao=function(e,t,o){var a=t,i=o;return function(){$.ajax({url:"/Item/PedirNotificacao",type:"Post",data:JSON.stringify(e),contentType:"application/json",success:a,error:i})}},Item.prototype.PedidoDeNotificacaoSuccess=function(e,t,o){var a=new Modal,i=o.getResponseHeader("location");a.Success("Notificação","Pedido de notificação cadastrado. Aguarde a aprovação pela operadora.","Fechar",function(){(new Navegacao).Url(i)})},Validacao.prototype.TipoItem=function(){return"0"!==this.Item.TipoItem.Get()||(this.message+="\nTipo do Item obrigatório",!1)},Validacao.prototype.CodigoAnvisa=function(){return 0!==Number(this.Item.CodigoAnvisa.Get())||(this.message+="\nRegistro Anvisa deve ser numérico",!1)},Validacao.prototype.ReferenciaOUDescricao=function(){return!(!this.Item.Referencia.Get()&&!this.Item.Descricao.Get())||(this.message+="\nReferência ou Descrição devem ser preenchidas",!1)},Validacao.prototype.Descricao=function(){return!!this.Item.Descricao.Get()||(this.message+="\nDescrição obrigatória",!1)},Validacao.prototype.CNPJ=function(){return this.Item.CNPJ.Get()?!!Util.isCNPJ(this.Item.CNPJ.Get())||(this.message+="\nCNPJ inválido",!1):(this.message+="\nCNPJ obrigatório",!1)},Validacao.prototype.Anexo=function(){var e=document.getElementById("filer_input_anexos");for(var t=function(e){var t=e.type.split("/");return["img","pdf","doc","docx","txt","png","jpg","jpeg","vnd.openxmlformats-officedocument.wordprocessingml.document","msword"].indexOf(t[1])>-1},o=function(e,t){return!(e.size/1024/1024>t)},a=0;a<e.files.length;a++){var i=e.files.item(a);t(i)||(this.message+="\nArquivo do tipo "+i.type.split("/")[1]+" não é permitido."),o(i,3)||(this.message+="\n Arquivo "+i.name+" ultrapassou o limite de 3 MB permitidos por arquivo")}},Validacao.prototype.isValid=function(){return 0===this.message.length},Validacao.prototype.Message=function(){return this.message},$(document).ready(function(e){$("#pesquisar").click(function(e){(new Item).Pesquisar()}),$("div.main-body").on("click",'input[name="incluir"]',function(e){(new Item).Incluir()}),$("div.main-body").on("click",'input[name="confirmar"]',function(e){(new Item).Confirmar()}),$('input[name="CodigoAnvisa"]').keydown(function(e){e.ctrlKey||Util.isCharacterNumeric(e.keyCode||e.which)||e.preventDefault()}),$('input[name = "CodigoAnvisa"]').on("paste",function(e){e.stopPropagation();var t=(e.originalEvent.clipboardData||window.clipboardData).getData("text");isNaN(Number(t))&&e.preventDefault()}),$('input[name="CNPJ"]').mask("00.000.000/0000-00",{reverse:!0})});